<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bus-based Cache Simulator: Trace File Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bus-based Cache Simulator
   &#160;<span id="projectnumber">v3.0</span>
   </div>
   <div id="projectbrief">A tool for education in computing - learn about coherence protocols, replacement policies, and SMP vs DSM</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Trace File Generation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md14">Notes</a></li>
<li class="level1"><a href="#autotoc_md15">Setup Instructions</a><ul><li class="level2"><a href="#autotoc_md16">1 Install Ubuntu on WSL2 (skip if your computer is running Linux)</a></li>
<li class="level2"><a href="#autotoc_md17">2 Initialize local copy</a></li>
<li class="level2"><a href="#autotoc_md18">3 Build gem5</a></li>
<li class="level2"><a href="#autotoc_md19">4 Build PARSEC benchmarks</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md20">Trace Generation Script</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md14"></a>
Notes</h1>
<ol type="1">
<li>The trace format is described on the <a href="index.html">main page</a> under Tool Suite &gt; Trace file generation</li>
<li><code>libs</code> and <code>tools</code> packages are not runnable. Probably since they are libraries or tools.</li>
<li>The group <code>netapps</code> work initially, but after a few seconds subsequent runs of <code>netapps</code> inexplicably hang indefinitely. There are three benchmarks under that category, and each of them individually hang indefinitely. After a system restart they work again.</li>
</ol>
<h1><a class="anchor" id="autotoc_md15"></a>
Setup Instructions</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
1 Install Ubuntu on WSL2 (skip if your computer is running Linux)</h2>
<ol type="1">
<li>Turn on 'Windows Subsystem for Linux' feature</li>
<li>Install Ubuntu with <code>wsl --install -d Ubuntu</code> (make sure the framework is WSL2)</li>
<li>Lauch Ubuntu to complete installation and setup user account</li>
</ol>
<h2><a class="anchor" id="autotoc_md17"></a>
2 Initialize local copy</h2>
<p>If you haven't already, download this repo with the following command: <code>git clone --recurse-submodules <a href="https://github.com/voltavidTony/cache-sim.git">https://github.com/voltavidTony/cache-sim.git</a></code>. If you already have this repo, but not the gem5 and parsec-benchmark sub-modules, then run this command: <code>git submodule update --init</code></p>
<h2><a class="anchor" id="autotoc_md18"></a>
3 Build gem5</h2>
<p>From within the <code>gem5</code> directory:</p>
<ol type="1">
<li>Install necessary dependencies. Depending on the Ubuntu version, run (I had to also install clang to get the <code>png</code> and <code>hdf5</code> libraries to work):<br  />
<code>sudo apt install build-essential scons python3-dev git pre-commit zlib1g zlib1g-dev libprotobuf-dev protobuf-compiler libprotoc-dev libgoogle-perftools-dev libboost-all-dev libhdf5-serial-dev python3-pydot python3-venv python3-tk mypy m4 libcapstone-dev libpng-dev libelf-dev pkg-config wget cmake doxygen</code></li>
<li>Make necessary changes to <code>gem5/src/mem/abstract_mem.cc</code>. At the time of writing, the version of gem5 used is v24.0.0.1, but since the changes are based on the existing <code>Memoryaccess</code> debug flag, they will likely work as-is for quite a while:<ol type="a">
<li>Before the <code>AbstractMemory::access</code> method on line 380, insert the following code snippet: <div class="fragment"><div class="line">#define ECE506TRACE(A) std::string reqName = system()-&gt;getRequestorName( \</div>
<div class="line">pkt-&gt;req-&gt;requestorId()); ::gem5::trace::getDebugLogger()-&gt;dprintf_flag( \</div>
<div class="line">(::gem5::Tick)-1, std::string(), &quot;ECE506Trace&quot;, &quot;%s\t%c\t%x\n&quot;, \</div>
<div class="line">reqName.substr(15, reqName.length() - 25), A, pkt-&gt;getAddr());</div>
</div><!-- fragment --></li>
<li>Then, after the <code>TRACE_PACKET</code> macro on line 455 (451 of the original file), insert the following: <div class="fragment"><div class="line">ECE506TRACE(pkt-&gt;req-&gt;isInstFetch() ? &#39;i&#39; : &#39;r&#39;);</div>
</div><!-- fragment --></li>
<li>Finally, after the <code>TRACE_PACKET</code> macro on line 478 (473 of the original file), insert the following: <div class="fragment"><div class="line">ECE506TRACE(&#39;w&#39;);</div>
</div><!-- fragment --></li>
</ol>
</li>
<li>Build the project with SCons (will take several minutes): <code>scons build/{ISA}/gem5.{variant} -j {cpus}</code><ul>
<li>{ISA}: target (guest) instruction set architecture (ALL for all possible ISAs). Gem5 should be built to support the same ISA as your local system, since the PARSEC benchmarks will be compiled to run natively</li>
<li>{variant}: compilation settings (<code>fast</code> is recommended to increase simulation speed, and <code>opt</code> for debugging error messages during simulation. <code>debug</code> is for debugging the simulator itself and shouldn't be needed). Note: The trace generation script uses the <code>fast</code> variant</li>
<li>{cpus}: specify # of threads with optional <code>-j</code> argument (strongly recommended for initial build, minor impact on incremental builds)</li>
<li><a href="https://www.gem5.org/documentation/general_docs/building#building-with-scons">Explanation of arguments here</a></li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md19"></a>
4 Build PARSEC benchmarks</h2>
<p>From within the <code>parsec-benchmark</code> directory:</p>
<ol type="1">
<li>Install necessary dependencies (These were the extra dependencies I needed. Your mileage may vary):<ul>
<li>parsec.glib: <code>sudo apt install gettext texinfo</code></li>
<li>parsec.mesa: <code>sudo apt install libx11-dev libxext-dev libxt-dev libxmu-dev libxi-dev</code></li>
</ul>
</li>
<li>Download necessary input files: <code>./get-inputs</code></li>
<li>Build PARSEC (will take several minutes):<ul>
<li><code>./bin/parsecmgmt -a build -p all {nthreads}</code> (not sure if the script uses the threadcount argument when building)</li>
<li>If a command is not found, try to run the command and Ubuntu will tell you what package to install</li>
<li>If a certain package is missing, chances are the correct package to install is <code>lib{package}-dev</code></li>
</ul>
</li>
<li>Test if the benchmark suite functions with the (default) test inputs: <code>./bin/parsecmgmt -a run -p all</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md20"></a>
Trace Generation Script</h1>
<p>Note:: This script uses the <code>fast</code> variant of gem5. It is located in the <code>tools</code> directory, but can be run from anywhere.</p>
<p>Usage: <code>./gen_trace.sh [benchmark] {inputsize} {nthreads} {ncpus}</code></p><ul>
<li><code>benchmark</code>: Specify the benchmark to run<ul>
<li>Can be of format <code>&lt;package&gt;.&lt;benchmark&gt;</code> or just <code>&lt;benchmark&gt;</code></li>
</ul>
</li>
<li><code>inputsize</code>: Determines the size of the input<ul>
<li>Can be one of: <code>test</code>, <code>simdev</code>, <code>simsmall</code>, <code>simmedium</code>, <code>simlarge</code>, <code>native</code></li>
<li>Defaults to: test</li>
</ul>
</li>
<li><code>nthreads</code>: Determines the number of worker threads to spawn<ul>
<li>Exact implementation can vary between benchmarks</li>
<li>Defaults to: 8</li>
</ul>
</li>
<li><code>ncpus</code>: Determines the number of CPUs in the gem5 simulation<ul>
<li>Defaults to: 16 </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
